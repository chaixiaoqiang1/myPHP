/*global angular*/(function(){var e;e=angular.module("ngQuickDate",[]),e.provider("ngQuickDateDefaults",function(){return{options:{dateFormat:"M/d/yyyy",timeFormat:"h:mm a",labelFormat:null,placeholder:"Click to Set Date",hoverText:null,buttonIconHtml:null,closeButtonHtml:"&times;",nextLinkHtml:"Next &rarr;",prevLinkHtml:"&larr; Prev",disableTimepicker:!1,disableClearButton:!1,defaultTime:null,dayAbbreviations:["Su","M","Tu","W","Th","F","Sa"],dateFilter:null,parseDateFunction:function(e){var t;return t=Date.parse(e),isNaN(t)?null:new Date(t)}},$get:function(){return this.options},set:function(e,t){var n,r,i;if(typeof e=="object"){i=[];for(n in e)r=e[n],i.push(this.options[n]=r);return i}return this.options[e]=t}}}),e.directive("quickDatepicker",["ngQuickDateDefaults","$filter","$sce",function(e,t,n){return{restrict:"E",require:"?ngModel",scope:{dateFilter:"=?",onChange:"&",required:"@"},replace:!0,link:function(r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b;return h=function(){return m(),r.toggleCalendar(!1),r.weeks=[],r.inputDate=null,r.inputTime=null,r.invalid=!0,typeof s.initValue=="string"&&o.$setViewValue(s.initValue),v(),d()},m=function(){var t,i;for(t in e)i=e[t],t.match(/[Hh]tml/)?r[t]=n.trustAsHtml(e[t]||""):!r[t]&&s[t]?r[t]=s[t]:r[t]||(r[t]=e[t]);r.labelFormat||(r.labelFormat=r.dateFormat,r.disableTimepicker||(r.labelFormat+=" "+r.timeFormat));if(s.iconClass&&s.iconClass.length)return r.buttonIconHtml=n.trustAsHtml("<i ng-show='iconClass' class='"+s.iconClass+"'></i>")},a=!1,window.document.addEventListener("click",function(e){return r.calendarShown&&!a&&(r.toggleCalendar(!1),r.$apply()),a=!1}),angular.element(i[0])[0].addEventListener("click",function(e){return a=!0}),d=function(){var e;return e=o.$modelValue?new Date(o.$modelValue):null,y(),g(e),r.mainButtonStr=e?t("date")(e,r.labelFormat):r.placeholder,r.invalid=o.$invalid},g=function(e){return e!=null?(r.inputDate=t("date")(e,r.dateFormat),r.inputTime=t("date")(e,r.timeFormat)):(r.inputDate=null,r.inputTime=null)},v=function(e){var t;return e==null&&(e=null),t=e!=null?new Date(e):new Date,t.toString()==="Invalid Date"&&(t=new Date),t.setDate(1),r.calendarDate=new Date(t)},y=function(){var e,t,n,i,s,u,a,l,h,p,d,v,m,g;u=r.calendarDate.getDay(),i=c(r.calendarDate.getFullYear(),r.calendarDate.getMonth()),s=Math.ceil((u+i)/7),d=[],e=new Date(r.calendarDate),e.setDate(e.getDate()+u*-1);for(a=v=0,g=s-1;0<=g?v<=g:v>=g;a=0<=g?++v:--v){d.push([]);for(n=m=0;m<=6;n=++m)t=new Date(e),r.defaultTime&&(h=r.defaultTime.split(":"),t.setHours(h[0]||0),t.setMinutes(h[1]||0),t.setSeconds(h[2]||0)),l=o.$modelValue&&t&&f(t,o.$modelValue),p=f(t,new Date),d[a].push({date:t,selected:l,disabled:typeof r.dateFilter=="function"?!r.dateFilter(t):!1,other:t.getMonth()!==r.calendarDate.getMonth(),today:p}),e.setDate(e.getDate()+1)}return r.weeks=d},o.$parsers.push(function(e){return r.required&&e==null?(o.$setValidity("required",!1),null):angular.isDate(e)?(o.$setValidity("required",!0),e):angular.isString(e)?(o.$setValidity("required",!0),r.parseDateFunction(e)):null}),o.$formatters.push(function(e){return angular.isDate(e)?e:angular.isString(e)?r.parseDateFunction(e):void 0}),u=function(e,n){return t("date")(e,n)},b=function(e){return typeof e=="string"?p(e):e},p=e.parseDateFunction,f=function(e,t,n){return n==null&&(n=!1),n?e-t===0:(e=b(e),t=b(t),e&&t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate())},l=function(e,t){return!e||!t?!1:parseInt(e.getTime()/6e4)===parseInt(t.getTime()/6e4)},c=function(e,t){return[31,e%4===0&&e%100!==0||e%400===0?29:28,31,30,31,30,31,31,30,31,30,31][t]},o.$render=function(){return v(o.$viewValue),d()},o.$viewChangeListeners.unshift(function(){v(o.$viewValue),d();if(r.onChange)return r.onChange()}),r.$watch("calendarShown",function(e,t){var n;if(e)return n=angular.element(i[0].querySelector(".quickdate-date-input"))[0],n.select()}),r.toggleCalendar=function(e){return isFinite(e)?r.calendarShown=e:r.calendarShown=!r.calendarShown},r.selectDate=function(e,n){var i;n==null&&(n=!0);if(typeof o.$viewValue=="string"){var s=p(o.$viewValue);o.$viewValue=s}i=!o.$viewValue&&e||o.$viewValue&&!e||e&&o.$viewValue&&e.getTime()!==o.$viewValue.getTime();var u=t("date")(e,"yyyy-MM-dd");return e=p(u+" "+r.inputTime),typeof r.dateFilter=="function"&&!r.dateFilter(e)?!1:(o.$setViewValue(e),n&&r.toggleCalendar(!1),!0)},r.selectDateFromInput=function(e){var t,n,i,s;e==null&&(e=!1);try{n=p(r.inputDate);if(!n)throw"Invalid Date";if(!r.disableTimepicker&&r.inputTime&&r.inputTime.length&&n){s=r.disableTimepicker?"00:00:00":r.inputTime,i=p(""+r.inputDate+" "+s);if(!i)throw"Invalid Time";n=i}if(!l(o.$viewValue,n)&&!r.selectDate(n,!1))throw"Invalid Date";return e&&r.toggleCalendar(!1),r.inputDateErr=!1,r.inputTimeErr=!1}catch(u){t=u;if(t==="Invalid Date")return r.inputDateErr=!0;if(t==="Invalid Time")return r.inputTimeErr=!0}},r.onDateInputTab=function(){return r.disableTimepicker&&r.toggleCalendar(!1),!0},r.onTimeInputTab=function(){return r.toggleCalendar(!1),!0},r.nextMonth=function(){return v(new Date((new Date(r.calendarDate)).setMonth(r.calendarDate.getMonth()+1))),d()},r.prevMonth=function(){return v(new Date((new Date(r.calendarDate)).setMonth(r.calendarDate.getMonth()-1))),d()},r.clear=function(){return r.selectDate(null,!0)},h()},template:"<div class='quickdate'>\n  <a href='' ng-focus='toggleCalendar()' ng-click='toggleCalendar()' class='quickdate-button' title='{{hoverText}}'><div ng-hide='iconClass' ng-bind-html='buttonIconHtml'></div>{{mainButtonStr}}</a>\n  <div class='quickdate-popup' ng-class='{open: calendarShown}'>\n    <a href='' tabindex='-1' class='quickdate-close' ng-click='toggleCalendar()'><div ng-bind-html='closeButtonHtml'></div></a>\n    <div class='quickdate-text-inputs'>\n      <div class='quickdate-input-wrapper'>\n        <label>Date</label>\n        <input class='quickdate-date-input' ng-class=\"{'ng-invalid': inputDateErr}\" name='inputDate' type='text' ng-model='inputDate' placeholder='1/1/2013' ng-enter=\"selectDateFromInput(true)\" ng-blur=\"selectDateFromInput(false)\" on-tab='onDateInputTab()' />\n      </div>\n      <div class='quickdate-input-wrapper' ng-hide='disableTimepicker'>\n        <label>Time</label>\n        <input class='quickdate-time-input' ng-class=\"{'ng-invalid': inputTimeErr}\" name='inputTime' type='text' ng-model='inputTime' placeholder='12:00 PM' ng-enter=\"selectDateFromInput(true)\" ng-blur=\"selectDateFromInput(false)\" on-tab='onTimeInputTab()'>\n      </div>\n    </div>\n    <div class='quickdate-calendar-header'>\n      <a href='' class='quickdate-prev-month quickdate-action-link' tabindex='-1' ng-click='prevMonth()'><div ng-bind-html='prevLinkHtml'></div></a>\n      <span class='quickdate-month'>{{calendarDate | date:'MMMM yyyy'}}</span>\n      <a href='' class='quickdate-next-month quickdate-action-link' ng-click='nextMonth()' tabindex='-1' ><div ng-bind-html='nextLinkHtml'></div></a>\n    </div>\n    <table class='quickdate-calendar'>\n      <thead>\n        <tr>\n          <th ng-repeat='day in dayAbbreviations'>{{day}}</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat='week in weeks'>\n          <td ng-mousedown='selectDate(day.date, true, true)' ng-class='{\"other-month\": day.other, \"disabled-date\": day.disabled, \"selected\": day.selected, \"is-today\": day.today}' ng-repeat='day in week'>{{day.date | date:'d'}}</td>\n        </tr>\n      </tbody>\n    </table>\n    <div class='quickdate-popup-footer'>\n      <a href='' class='quickdate-clear' tabindex='-1' ng-hide='disableClearButton' ng-click='clear()'>Clear</a>\n    </div>\n  </div>\n</div>"}}]),e.directive("ngEnter",function(){return function(e,t,n){return t.bind("keydown keypress",function(t){if(t.which===13)return e.$apply(n.ngEnter),t.preventDefault()})}}),e.directive("onTab",function(){return{restrict:"A",link:function(e,t,n){return t.bind("keydown keypress",function(t){if(t.which===9&&!t.shiftKey)return e.$apply(n.onTab)})}}})}).call(this);